---
kind: pipeline
type: docker
name: Default

trigger:
  event:
    - push
    - tag

steps:

  - name: audit
    image: node:12
    commands:
      - npm audit --package-lock-only --production --audit-level=moderate

  - name: install
    image: node:12
    environment:
      NPM_CONFIG_IGNORE_SCRIPTS: true      
    commands:
      - npm ci

  - name: test
    image: node:12
    commands:
      - npm test

  - name: check-coverage
    image: node:12
    commands:
      - npm run coverage

  - name: build
    image: node:12
    commands:
      - npm run build
      - npm ci --production

  - name: static-security-scan
    image: quay.io/natlibfi/nodejsscan
    commands:
      - python /usr/src/app/cli.py -d dist

  - name: npm
    image: plugins/npm
    settings:
      registry: 'https://registry.npmjs.org/'
      token:
        from_secret: npm_token
    when:
      event: tag 
---
kind: pipeline
type: docker
name: Update dependencies

trigger:
  event:
    - custom
  branch:
    - master

steps:

  - name: publish
    image: quay.io/natlibfi/drone-npm-git-publish
    settings:
      git_user_name: natlibfi-melinda-automation
      git_user_email: 65649125+natlibfi-melinda-automation@users.noreply.github.com
      git_ssh_key:
        from_secret: ssh_key
      git_gpg_key:
        from_secret: gpg_key
---
kind: secret
name: npm_token
data: EbWoRzH5ezRXvRcRTfCbCYO4mBd3yYHK+e85U1bOHCjyBgZH4amm5yj/Dh19JH6GPF66IfER46je+IPm61BGGQ==
---
kind: secret
name: ssh_key
data: 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
---
kind: secret
name: gpg_key
data: jOL4RnpRO0Y4TyO2xbNdVmWFrar/FsGMDWhuuoOBDAML+SScDufU+bGFSd261vR8KzZk38a6B4Gr0/seINesBiiAj2p8DRPFDrmodrM5ewgp7kvy2XOpbpLOB92b4ax9sErTiiRKuXSPoqDaQIigq0iX5Ale1cKdXCnqIPCHZqTjYXIWWs/IZX5cLCpQ759NhDi+QWIp9cqaUuvCvzgcEHMlu7PfJSt/moRDZqOviaHpxpjcNbNncBJTNNSBFLzuN5MxSN4fTWItEZyNJbOdca7tKB0w7D5Kp/OmswpVWxDAizN5EZz7C9ngk6wz5prcIx6Cfy4I9oQ9VE/Zrr7YoKRzlbXCAbSaBzlJm+9KKZU7WMVpQ3vW/MuIeDAevPi/SD79q/t995oRUAk+LnTbr7hQ+fg1RxbT+5b7arl/hTetTxJ3VOpiZVEZlmLrTByRJ1ZJ6wGDqO7qwtyNGvQ/mqVWwtdGpjdfc5+w3xupuydJX92hjXFJuoJT/1vssGIz8tqciZWiweNuzpDU4DTADdRZf3EEqiu1wENTBZgb5pYeRRgqQ/uOzTDsjtdvjy5LVvEnN2L+6dmsX+mS0mn99RTwCcJ2baT4Wr+vQCq1SvXLvNySgn173tfPcTY4icGw0iPHEdUD1Yp3EGf+fto83gkp7pU2hfeLECKvfqcPYyM230C+xwcxwVDBrKPVDjtF+Hp3f6P+FFF5SSuXN9xMb4RS0+y9Zysg4OuHUojXElSeA7XQWw9rdGG578+wOQYU3qBpcOpFDbAzWw0IzjfpVSFtjf+Vx27/Y1JQvpjZdP+sElgmHXjGvezDurYb09hKSuLn+MiM7yFrUxthMtSWUEEs4eHQs0S7N2rztMqoOIMhCv1kjuSyqYsN+624vGsKVN2ie1KaDOwy4j732t0YS2MGd0CwgfbDfw3LWU+iSysDh/CV63Ad9YPQ7tum9mmyscIVMj99vKSKIuyPmsM/ZaA+fYxNFfhRm6aGbVZn59FNRhxmz5p/TkfWwajUrB0mh4S1qzT+yd9AKsT8eVsrUa8oNJsQTUUMt6huWYSQLVIrKBFrHNdsjAfomDMJWtba9xbVsX8361IH6aV0ivkK17ytyhMvxy1xsO0ly4HCfEoUM4JaHrTatlKZG+J60Sf+6hYw7ZKS7eVwrN5sruJnOpMNWrUlctSaMhKxJ+j5VdrGF/Oo3HeVD0kjTsFbnC/QPhzOBzalXja9VPFxkjYCx/T29nT0n3cREltGTzcjj+Ixmu746L4NnxacY1gXz8meJYVTRtVM1SvMXUGQ6pMHVIu2UvPBvB6MSs0uRO8Us9NXgvGbnBEQXIMkMfoSpqkJDpQzX4cm0M14Cv4AdkoLD+DeQlKbM5HOUOKaA9Ap367/TKarKHNDr4Hkbwd7+RavyJZ6finpGFLS/q2TWCTe8G3OS2ti7CkZ1YUYz0aHhbwMCtX4+o2PUyjCLkaR9Fl9LA7ozYAswfSxIyTlOPB3YQ06SBRTpAGy3KVUxjg38oRQXpBFTSD9B0roWDL6mIDywIK0dRUAGGhdUCHZrhaa3G/b3GOLGGfPienyqISsOErKPURWCBB3y0+c7bIt6iDXRQd4an+mOHSCoIgilF0kQcsvDEJe27jo0h/lXGfremosVyBJoJJxoZI5wj5y2AwyUHoGEk9+aygLiMCioD1QX03f6BnoSV62/vmuGVC0+3oJRvfgc2xaV+9DyAm2Hc5ahFDAfPFAp8dvXtaN80BcDTB+c5hSMoumWN/JQhRymI1KTLfp0IpqrWyAMVkvfit4uqOGssSYlVzYFdOggHYT9QbTjHb26i3E80SBEFD8HqY4llQpjYhq+FM7djP3AhsvxyxmkC5B+VsBH71O4tj9+M4zvwl4J8Yyr21W9f19q4QJwzJhqAtYmndGYQ8GyEQ4+zxZHJewFeyIKbiCrFHc8RPgtdT0MeuiTK4ENYQ3F/qohOOd+56UFmw4n922Ecn54MugM9CKB5oiKF8Rj/zulhc75xHXclV2iTzyMWLTZdblm1W029VnZi+OmD3TNoxOWBLyfcx5VurP2lQhwKWgnfugYClZ+f9uXbrS6Fajxk25c00bmmS6hYfJ5dBO8tPXHpW9vu5XaDXdiwfGIeKmporXhMhNZRs1yAZZJMLi+UqrydcO3vLQ4cJyP5M9PP/Kdj41z+Fudyg0fS2hxVLL8jUHWjq6OGpWaKrbO4zHDM1Rjj/TgYLNFCDu2O/1o++DY1/e186Exau/U/PzV5hR/lDb6k60L5c0ynGcSotyCyrXCUgNr2g2VXN/MaLwBATyBqsRTZZ0qGofyeKEfNIDkZmZlsNSxHcaYhwD1XiIkBrmxTqXPK8tgc0tw2LjwwB6VRn07hml1uYnxfL7p1lM81x87jjOvmmJig12Np3+gP9yMvMM8D5rz+vM4ZFh//8Ge5i7+hqShe0KpF5q4S0Nw5Ca1ysmuMUtXYCSWmx3lqC4pnaibwyHKuzL3RIdRLYifCYABjzxPYDskv0hGpuw786dwCBmEzoG+tJtqV4qu3c1JuekFBDFMlXdPqs+fBArN3DIAzhCf3j79V8+ZAqtXVWFGj2Mnk63LNLJJZ6QBhUBDxxhxz1ML0eS6pigo/uwbPZx5Senm04Y5c363ahroBFAxPqfoiSg5DcZcjD85Fi0o6+GinkaPc8fWYQPvFiBhR3NXxklFODKNIwEeN0VuoxHeqGxry009nOewqXprQyICoPhscBGc9/A4qG+Kk8VNfqfsswBA3+eL0MVJfHpTCb6hoiZJUtTQRLg6geV+lvRO+y7g14ksHOS2PbtfXpk9lgcJIU4Gd3o4aTKpLySBjWuM0IisBd19On82aylir8TEBEkWulGvpxahjYFZYoTu9bHEq+Cb5IiIhrRVRZTgNeipfKridrEP/5ZietVyWwNCxD6xb61HwUfmBto1eehz39R+R+Guae2BAOhGr2SLDjYLwn3zU5WxF2pA1rVlUQDwOOR1cTfpXvelA/YkkdkTkMDUCV1dQ9Hhg/aCMwoB98FvgTRDoW5BvKg69tuWexLz0FqyPVIC+osBjLyBLdYh1I2elexlXLskoX0aRpB4JXZRDz7KASK2T6pDWnJU84qULRJ9I62Dxp/Fn17ls5WA148X1RozRkvnLLEtTnR/V3bJ3+4nZPYD55so7oKitBRUj+DP0rWc10DgIMkKVBW5VxSB0aZlE4/0rWUuInC4VlUpyDG0NFcimkFujbdfEEamuK3LosDbDeUwi+U5M2TE7o6FYMwyRM1QeBM0T9q3DoS/Wfc1UVzaIerve3KbuJ0HuGNBuiRAK+qjCoXsT2zjiohQfIgU1J4w+N+o8bST4SrUyhKQK1mRbJqYD32K78Sleusvbtp1J36QsrYLWMSJa9S7IEvN4lkue4EvrlvprVmc34jqhEXvZU8VBQcXAY/Bu+0+WyQdH5RzNA1qLmXaNl8KWe+21PEGyO0a5y9aYrQVV/2gPbaUlsCGt/ncuPJZochiyHLAwjKwGz1oci8Rcud3Q5e50Z5/7kSUrQViCA/NErQ4dWX7g3DUe24hULdrg3qLiaNHhkI8Nh+CsNXrS8uQVGDfSD/o2pb6GbVECPezgplaCYg15HIUckJnNMULBeei6pbEMUVPqGqBT+iVIfHroSntYPa3dKojLDtHfJYtRE2Ag09KPX+iZ9rQ4Z0Pxy+hIyhTPnjf5x9ZSutSgny9GYM4eeM8yyjIWppQEs3qtoS+TCKNIxK55/cGpRV1lvw5kppirfPIBnWtRS9Dhccwl/pgYGSMTXzdq2EUsr8EJPzXolPgSEvUj4SZdmJP9Ki40m1L0r+ZQUk13iQ57uxKSeZ4bkFSsHTaGd/hRRvIlT+Z8xcUWXDR3xRlg6BCtRUUWh4KiTZVRQOgGerZ63sXGCCUGBjqAA0cReIl7VqCJE3OpKghVOt/5ICUJ3QVJ2GHQpTX2wYYB2VrxMqY/BiZQ0C5hOhRmeb98lyp4UAYU3dplslveQZ7OScQjhG9xqKavkaXrEDb5/Am2KpPPYD8yjgMLqtm1eVXLhi6qNyLlRitu25gBl24N1bewVOOG7C5cOocWMJjbZaCK4oXlAc5C7fE7L+iGgL5Bw12oHn4PvaWvb0zHwIDS7TL8lFbW1Wy2trrAlQ1u7za7vWBx4t4H0Tre4GTmidA6QkIv/apRUyJlgT1FlyuxiUuyiB/lRobK0Yel8xYZbbRsWxJ0yCd0ztSKnjF6g91ZJNN67/wBQasLBtgK/uegk5LOUq1VzpUcangnc3dS0oNbdjOZPQOliSZEu/yEMMMzKdYx1ps2DCQ4wZvyOCqdcQm48rcsP+mUbg2fzabzu35HDLRRlw1gCM5wcmj7YYpKv0NrQra07LMIFjQn1o0obeHirVEsePxKiJYcnjQg1WSg/WbejcKvy4QL1w7DPSk0laRgWUOYp+oLK1ufiQWjlRq0zyTuAvtanXJeyB0ZYqLBoDSTfqT5yFA75jEOW3BXpx3j3SFV2MPAZQEqyacaP5XMYfd0gLwIqz1BwSHLoboVE4eNoY75hdJx+V2L8t7XE1CN8ADAUidtWauro+aRvyGfhp+h+i4hlwgx+JW+2ZH7ZWEE2NQO4ZAV2m0+mJAuQtyuT4uYSbc00AYutfugGLx+Cu/jWEo+yEEZqjOzsQieKjya9apqNPB3lLssgRcvH1al2o9WHTAIgimY3vebzuM9I8D7APFEB2ek5GWq/1KlkPAJ/cIp+hn7mMQ8lsklfq6yYlrIwHmAZtgfTNkl+RZdybvyAS7EctSZZJVBMDOCgHanaM3QAaKvtD/hRMURFr+KDmkIkkanW6URuRkRTPlREOLklkIN3hK5gig7WAqfUZZzJhey6Yn7gNMVhVJVI7oZfMFbo2ZcVH5BNdJ7WUQgoqeKGrEnCiRqe9P1viKGSDt5uGSl/34ONxChHuhMyfoCffnUeYP31ndseOpsim6fyNu4fCMBoxKcpEGt/UiTuD3yZt1sC6PfsB+nM23o+fxfyEKWqpvhXAs8wKn0JH5alE/fgw3oinyHiywStzWRpDDzQvq+AP1qbanC2def4FN1UQ77+NyIs4v44Xvpu9bBR1jodZCkPcGcqADG5/zsH9xO58EMdQc0UMdzkaJ8JAHezhKIzYjiRUyah0AJhE8j8dncXBWc88sVRQquLs+ZWSZXcYH9aAsybSJiI6OuOBEl7NgujB/fl6OoEa2B0SyPAOp7ajpYTD2QJ0aQ0YbUqUbH/H7mfW5I+unl8WrfK/vA0FWvuskh7ZxTuh63eQRZNidb4VNySjr3IgALdB5at1/xsuv1dvzvke8DlQIla07CLS1QgqES2Lb+zvW5XQePaD4QTznE/yieOyl0fNSRR/P0VGmq/0cXJUo4n6V+M/6Jfr49PZ0yf86Mg2SmKgJAGh3o/ANHamYkGMusZTTOa9bDkCNRBQUSwq2goJ1blPu0S1suz5DvXaZXwSr23Y9HE041c1QUhaIFUofxij23UySSAd5T6Vm0NrmC5XUlCp4ziMJBk/UQO8Ifn7+9AP7esia4gFfvEA3qdq8cV/SDha3U9ahpEt0ViK+MxYgPZBzvG94nX6p7c+001ceeIB3aBTW5zy6metDg/wqifKnk6ZhMwPo+ybdCb4mlvANfdpwMI8lsKNaOB6fdKIrmEgj2wR0tne32fP0JyTp9I3ki7qq76N5k1li/6LKV7pzvCHIznRY8wED13FJa4QHxso7VqpAkQXTt9GYcFIKh0+9M7RdI++eGtwtPctlh7nrlcFsgeMbGp8DrJx/KyCRRInnxoSaBlBJIMfedClXyqxrKC2VSlnIVRngoiaBw/wGFHVUfIWUVjJx+swqziflSgxHGUJanHGfLwLlUl5C0S2M2mC9CLncUJg97fIgnDwSLABsn0GHQ0239HO31bors+iCaurmH0mGI/J2Ay4ZnH5TSlzKx7iKk/Q0ZGHgNzBQYV9d9wwBYAm4lI5Yirthj972fH0v1d6JGsiLcni41OrxVHex8zMBhDFGCYHhdDZXb5gEJq/AtiNysbmDSkPHSjhAEZdCcgfF3C+v3+2KsZKX++jXUafbhdO86fkmEr4KN1WKiXm/2oPq6T4Jj69SbMi906X9pC35BH0uFu/Ev7NfGTs1hWXdZ4IBUCSioxzgcCm1uqHF0Xo+tLXe2DW2NN8Zm3d4XHq02A2adVe2nL2IU5Rw1FLQhfXoEjwEVK/rtHLAJonIpO987FTwbt2qGzdQQkOk2yjt03YdRJ9FM0KdjtoHWT13vMaPlunUxjoOSUN4thnS4pPGiv6We2h0pCdYOoilitNN9hy3N89X8Qm8vVoqHiWm9qZFXwJRO5s5jKBkSKHPXMMxEpb/A3iPApDyjVGs5/q9krfTOH2cQHNfcKu8zuSWMUAn0BrQPX4re/ZF84mZK3RP4rbCbCHK6uf1cgKKKeO80u0MEzKT6I9SQXbhn+Lu7vQiLFw2ZqFSj4ZPsCkJaRcKGHsV8tJTFuQ+O1a3NtzeezfiBUnmnwSRWn5KmWc4ykS4LjkuqAsGzyE1HaExHREhzoLU9TyMsH12S2VjEQNsPt6zyZocqTJwHL3crzqqDiQK72fe0QJRtTg7EewvI/7Th8tMPMwm28s7FYnpB+gDw9mnQ4jzA87zaLzdtXU7Hmex1qT4hppLcQvNXeQkMs8X3X2xYV6DP4/N6kCpI8uTkM7XA==
---
kind: signature
hmac: 0c249630843b911d8439f116b2092ff6cccbd3c2acf881b932d0cdf9e18af7a8

...
